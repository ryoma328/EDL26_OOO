<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤.ìš´.ì™„ ê°œì¸ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .login-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .login-section input {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px;
            width: 250px;
        }

        .login-section button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .login-section button:hover {
            transform: translateY(-2px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
        }

        .charts-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            height: 400px;
            position: relative;
        }

        .chart-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .chart-wrapper {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .recent-activities {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .activity-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .activity-item:hover {
            background-color: #f8f9ff;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-type {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .streak-badge {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: bold;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .user-info {
                flex-direction: column;
                text-align: center;
            }
            
            .login-section input {
                width: 100%;
                max-width: 300px;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒâ€â™‚ï¸ ì˜¤.ìš´.ì™„ ê°œì¸ ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì˜¤ëŠ˜ë„ ìš´ë™ ì™„ë£Œ! ë‹¹ì‹ ì˜ ìš´ë™ ì—¬ì •ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
        </div>

        <div id="loginSection" class="login-section">
            <h2>ë¡œê·¸ì¸</h2>
            <p>ì´ë©”ì¼ì„ ì…ë ¥í•˜ì—¬ ê°œì¸ ëŒ€ì‹œë³´ë“œë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            <br>
            <input type="email" id="emailInput" placeholder="ë“±ë¡í•œ ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
            <br><br>
            <button onclick="loadDashboard()">ëŒ€ì‹œë³´ë“œ ë³´ê¸°</button>
            <br><br>
            <p style="color: #666; font-size: 0.9em;">
                * ì‹¤ì œ êµ¬ê¸€ ì‹œíŠ¸ ë°ì´í„°ì™€ ì—°ë™ë˜ì—ˆìŠµë‹ˆë‹¤!<br>
                ë“±ë¡ëœ ì´ë©”ì¼ë¡œ ë¡œê·¸ì¸í•˜ì—¬ ê°œì¸ë³„ ìš´ë™ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”
            </p>
        </div>

        <div id="dashboardSection" class="hidden">
            <div class="user-info">
                <div>
                    <h2 id="userName">ì‚¬ìš©ìë‹˜</h2>
                    <p id="userEmail"></p>
                </div>
                <div class="streak-badge" id="streakBadge">
                    ğŸ”¥ 3ì¼ ì—°ì† ìš´ë™ ì¤‘!
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">15</div>
                    <div class="stat-label">ì´ ìš´ë™ì¼ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="thisMonth">8</div>
                    <div class="stat-label">ì´ë²ˆ ë‹¬ ìš´ë™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="favoriteExercise">ëŸ¬ë‹</div>
                    <div class="stat-label">ê°€ì¥ ë§ì´ í•œ ìš´ë™</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreak">3</div>
                    <div class="stat-label">ì—°ì† ìš´ë™ì¼</div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart-title">ìš´ë™ ì¢…ë¥˜ë³„ í†µê³„</div>
                    <div class="chart-wrapper">
                        <canvas id="exerciseChart"></canvas>
                    </div>
                </div>
                <div class="chart-container">
                    <div class="chart-title">ì›”ë³„ ìš´ë™ í˜„í™©</div>
                    <div class="chart-wrapper">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="recent-activities">
                <div class="chart-title">ìµœê·¼ ìš´ë™ ê¸°ë¡</div>
                <div id="recentActivitiesList">
                    <div class="activity-item">
                        <div>
                            <span class="activity-type">ëŸ¬ë‹</span>
                            <span style="margin-left: 15px;">ì˜¤ëŠ˜ ì•„ì¹¨ í•œê°•ì—ì„œ 5km ë‹¬ë¦¬ê¸°</span>
                        </div>
                        <div style="color: #666;">2024-06-19</div>
                    </div>
                    <div class="activity-item">
                        <div>
                            <span class="activity-type">ì›¨ì´íŠ¸</span>
                            <span style="margin-left: 15px;">í—¬ìŠ¤ì¥ì—ì„œ ìƒì²´ìš´ë™ ì§‘ì¤‘</span>
                        </div>
                        <div style="color: #666;">2024-06-18</div>
                    </div>
                    <div class="activity-item">
                        <div>
                            <span class="activity-type">ìš”ê°€</span>
                            <span style="margin-left: 15px;">í™ˆìš”ê°€ 30ë¶„ ì™„ë£Œ</span>
                        </div>
                        <div style="color: #666;">2024-06-17</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Google Apps Script ì›¹ì•± URL (ìµœì¢… ë°°í¬ëœ URL)
        const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbznELAWoFpoHQ0knouZGh7GDYrNtbVL1HBlV4WXUdSLto9sh_Sdkjj1jvC0MK7yIGh9Gg/exec';
        
        // ìƒ˜í”Œ ë°ì´í„° (Google Apps Script ì—°ë™ ì „ í…ŒìŠ¤íŠ¸ìš©)
        const sampleData = {
            'user@example.com': {
                name: 'ê¹€ìš´ë™',
                totalDays: 15,
                thisMonth: 8,
                favoriteExercise: 'ëŸ¬ë‹',
                currentStreak: 3,
                exerciseTypes: {
                    'ëŸ¬ë‹': 5,
                    'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹': 4,
                    'ìš”ê°€': 3,
                    'ê±·ê¸°': 2,
                    'ìì „ê±°': 1
                },
                monthlyData: [1, 2],
                recentActivities: [
                    { type: 'ëŸ¬ë‹', date: '2024-06-19', description: 'ëŸ¬ë‹ ìš´ë™ ì™„ë£Œ' },
                    { type: 'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹', date: '2024-06-18', description: 'ì›¨ì´íŠ¸ íŠ¸ë ˆì´ë‹ ìš´ë™ ì™„ë£Œ' },
                    { type: 'ìš”ê°€', date: '2024-06-17', description: 'ìš”ê°€ ìš´ë™ ì™„ë£Œ' }
                ]
            }
        };

        async function loadDashboard() {
            const email = document.getElementById('emailInput').value;
            
            if (!email) {
                alert('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© í‘œì‹œ
            const button = document.querySelector('button');
            const originalText = button.textContent;
            button.textContent = 'ë¡œë”© ì¤‘...';
            button.disabled = true;

            try {
                let userData;
                
                // Google Apps Script URLì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                if (GAS_WEB_APP_URL !== 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                    userData = await fetchUserData(email);
                } else {
                    // ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                    userData = sampleData[email] || sampleData['user@example.com'];
                    console.log('ìƒ˜í”Œ ë°ì´í„°ë¥¼ ì‚¬ìš©ì¤‘ì…ë‹ˆë‹¤. ì‹¤ì œ ì—°ë™ì„ ìœ„í•´ì„œëŠ” Google Apps Script URLì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                }

                if (userData.error) {
                    alert(userData.error);
                    return;
                }
                
                // UI ì—…ë°ì´íŠ¸
                updateDashboardUI(userData, email);
                
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', error);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒ˜í”Œ ë°ì´í„°ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.');
                
                // ì˜¤ë¥˜ ì‹œ ìƒ˜í”Œ ë°ì´í„° ì‚¬ìš©
                const userData = sampleData['user@example.com'];
                updateDashboardUI(userData, email);
            } finally {
                // ë¡œë”© ì™„ë£Œ
                button.textContent = originalText;
                button.disabled = false;
            }
        }

        async function fetchUserData(email) {
            const response = await fetch(`${GAS_WEB_APP_URL}?email=${encodeURIComponent(email)}`);
            
            if (!response.ok) {
                throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
            }
            
            return await response.json();
        }

        function updateDashboardUI(userData, email) {
            // UI í‘œì‹œ
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            
            // ë°ì´í„° ì—…ë°ì´íŠ¸
            document.getElementById('userName').textContent = userData.name + 'ë‹˜';
            document.getElementById('userEmail').textContent = email;
            document.getElementById('totalDays').textContent = userData.totalDays;
            document.getElementById('thisMonth').textContent = userData.thisMonth;
            document.getElementById('favoriteExercise').textContent = userData.favoriteExercise;
            document.getElementById('currentStreak').textContent = userData.currentStreak;
            document.getElementById('streakBadge').textContent = `ğŸ”¥ ${userData.currentStreak}ì¼ ì—°ì† ìš´ë™ ì¤‘!`;

            // ìµœê·¼ í™œë™ ëª©ë¡ ì—…ë°ì´íŠ¸
            updateRecentActivities(userData.recentActivities);

            // ì°¨íŠ¸ ìƒì„±
            createExerciseChart(userData.exerciseTypes);
            createMonthlyChart(userData.monthlyData);
        }

        function updateRecentActivities(activities) {
            const container = document.getElementById('recentActivitiesList');
            container.innerHTML = '';
            
            activities.forEach(activity => {
                const activityDiv = document.createElement('div');
                activityDiv.className = 'activity-item';
                activityDiv.innerHTML = `
                    <div>
                        <span class="activity-type">${activity.type}</span>
                        <span style="margin-left: 15px;">${activity.description}</span>
                    </div>
                    <div style="color: #666;">${activity.date}</div>
                `;
                container.appendChild(activityDiv);
            });
        }

        function createExerciseChart(exerciseData) {
            const ctx = document.getElementById('exerciseChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ì‚­ì œ
            if (window.exerciseChartInstance) {
                window.exerciseChartInstance.destroy();
            }
            
            window.exerciseChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(exerciseData),
                    datasets: [{
                        data: Object.values(exerciseData),
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#f093fb',
                            '#f5576c',
                            '#4facfe',
                            '#43e97b',
                            '#fa709a'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createMonthlyChart(monthlyData) {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            // ê¸°ì¡´ ì°¨íŠ¸ê°€ ìˆë‹¤ë©´ ì‚­ì œ
            if (window.monthlyChartInstance) {
                window.monthlyChartInstance.destroy();
            }
            
            // í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ìœ¼ë¡œ ìµœê·¼ 2ê°œì›” ë¼ë²¨ ìƒì„±
            const today = new Date();
            const labels = [];
            
            for (let i = 1; i >= 0; i--) {
                const targetDate = new Date(today.getFullYear(), today.getMonth() - i, 1);
                const monthLabel = targetDate.toLocaleDateString('ko-KR', { month: 'long' });
                labels.push(monthLabel);
            }
            
            console.log('ì›”ë³„ ì°¨íŠ¸ ë¼ë²¨:', labels);
            console.log('ì›”ë³„ ì°¨íŠ¸ ë°ì´í„°:', monthlyData);
            
            window.monthlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels, // ë™ì ìœ¼ë¡œ ìƒì„±ëœ ë¼ë²¨ ì‚¬ìš©
                    datasets: [{
                        label: 'ì›”ë³„ ìš´ë™ íšŸìˆ˜',
                        data: monthlyData,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#667eea',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                stepSize: 1 // ì •ìˆ˜ ë‹¨ìœ„ë¡œ í‘œì‹œ
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    }
                }
            });
        }

        // ì—”í„°í‚¤ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥
        document.getElementById('emailInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadDashboard();
            }
        });
    </script>
</body>
</html>
